<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Energético – Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #111827;
      --bg2: #1f2937;
      --text: #fff;
      --card: #1e293b;
      --accent: #2563eb;
    }

    body {
      margin: 0;
      display: flex;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
    }

    /* ---------- SIDEBAR FIJO ---------- */
    aside {
      position: fixed;
      top: 0;
      left: 0;
      width: 260px;
      height: 100vh;
      overflow-y: auto;
      background: var(--bg2);
      padding: 20px;
      box-shadow: 4px 0 10px rgba(0,0,0,0.4);
      z-index: 100;
    }

    aside h2 {
      text-align: center;
      color: var(--accent);
    }

    aside .menu-item {
      padding: 12px;
      margin-top: 10px;
      background: var(--card);
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
      text-align: center;
    }

    aside .menu-item:hover {
      background: var(--accent);
    }

    /* ---------- CONTENIDO PRINCIPAL ---------- */
    main {
      margin-left: 260px; /* para que no tape el sidebar */
      padding: 25px;
      width: calc(100% - 260px);
    }

    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .chart-container {
      position: relative;
      height: 350px;
      width: 100%;
    }
  </style>
</head>

<body>

  <!-- --------------------------------------------------------- -->
  <!--                         SIDEBAR FIJO                     -->
  <!-- --------------------------------------------------------- -->
  <aside>
    <h2>Panel Energético</h2>

    <div class="menu-item" onclick="scrollToSection('voltage')">Voltaje</div>
    <div class="menu-item" onclick="scrollToSection('current')">Corriente</div>
    <div class="menu-item" onclick="scrollToSection('power')">Potencia</div>
    <div class="menu-item" onclick="scrollToSection('energy')">Energía</div>
    <div class="menu-item" onclick="scrollToSection('frequency')">Frecuencia</div>
    <div class="menu-item" onclick="scrollToSection('pf')">Factor de Potencia</div>
  </aside>

  <!-- --------------------------------------------------------- -->
  <!--                     CONTENIDO PRINCIPAL                  -->
  <!-- --------------------------------------------------------- -->
  <main>

    <h1>Dashboard de Monitoreo</h1>

    <!-- VOLTAJE -->
    <div id="voltage" class="card">
      <h2>Voltaje (V)</h2>
      <div class="chart-container">
        <canvas id="chartVoltage"></canvas>
      </div>
    </div>

    <!-- CORRIENTE -->
    <div id="current" class="card">
      <h2>Corriente (A)</h2>
      <div class="chart-container">
        <canvas id="chartCurrent"></canvas>
      </div>
    </div>

    <!-- POTENCIA -->
    <div id="power" class="card">
      <h2>Potencia (W)</h2>
      <div class="chart-container">
        <canvas id="chartPower"></canvas>
      </div>
    </div>

    <!-- ENERGIA -->
    <div id="energy" class="card">
      <h2>Energía (kWh)</h2>
      <div class="chart-container">
        <canvas id="chartEnergy"></canvas>
      </div>
    </div>

    <!-- FRECUENCIA -->
    <div id="frequency" class="card">
      <h2>Frecuencia (Hz)</h2>
      <div class="chart-container">
        <canvas id="chartFrequency"></canvas>
      </div>
    </div>

    <!-- FACTOR POTENCIA -->
    <div id="pf" class="card">
      <h2>Factor de Potencia</h2>
      <div class="chart-container">
        <canvas id="chartPF"></canvas>
      </div>
    </div>

  </main>

  <!-- --------------------------------------------------------- -->
  <!--                          SCRIPT                          -->
  <!-- --------------------------------------------------------- -->
  <script>
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: "smooth" });
    }

    const url = "https://script.google.com/macros/s/AKfycbxQ76NS3WKa9OUiON-yX6jix6hCzW2qTKP7iDTNSks1ODQWc2gZyJOKEG2Gnq6zfyux/exec";

    async function getData() {
      try {
        const res = await fetch(url + "?colsToQuery=A,B,C,D,E,F,G");
        const data = await res.json();
        console.log(data);

        // Crear gráficas
        makeChart("chartVoltage", "Voltaje (V)", data.voltage);
        makeChart("chartCurrent", "Corriente (A)", data.current);
        makeChart("chartPower", "Potencia (W)", data.power);
        makeChart("chartEnergy", "Energía (kWh)", data.energy);
        makeChart("chartFrequency", "Frecuencia (Hz)", data.frequency);
        makeChart("chartPF", "Factor Potencia", data.pf);

      } catch (e) {
        console.error("Error obteniendo datos:", e);
      }
    }

    function makeChart(canvasId, label, dataset) {
      new Chart(document.getElementById(canvasId), {
        type: "line",
        data: {
          labels: dataset.map((_, i) => i + 1),
          datasets: [{
            label: label,
            data: dataset,
            borderWidth: 3,
            borderColor: "#2563eb",
            backgroundColor: "rgba(37,99,235,0.3)",
            fill: true,
            tension: 0.3,
            pointRadius: 2,
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: "#fff" } } },
          scales: {
            x: { ticks: { color: "#fff" } },
            y: { ticks: { color: "#fff" } }
          }
        }
      });
    }

    getData();
  </script>

</body>
</html>
